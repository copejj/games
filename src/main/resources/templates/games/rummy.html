<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<!-- Your common-head fragment includes Alpine and Tailwind -->
	<head th:replace="~{fragments/common :: common-head(title='Rummy')}"></head>

	<body class="bg-gray-100 min-h-screen">
		<div th:replace="~{fragments/layout :: header}"></div>

		<main class="p-4 max-w-md mx-auto">
			<!-- Bind to the 'rummyApp' defined in main.js -->
			<div x-data="rummyApp" class="space-y-4">
				<!-- Top Controls Container -->
				<div class="flex gap-3 mb-6 items-stretch">
					<!-- Add Player Button -->
					<button @click="addPlayer" 
							class="flex-1 bg-blue-600 text-white font-bold py-4 px-2 rounded-2xl shadow-lg active:scale-95 transition">
						+ Add Player
					</button>
					
					<!-- Reset Button -->
					<button @click="resetGame" 
							class="flex-1 bg-white text-red-600 font-bold py-4 px-2 rounded-2xl border-2 border-red-500 shadow-sm active:bg-red-50 transition">
						Reset Game
					</button>
				</div>

				<template x-for="(player, index) in players" :key="index">
					<div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 mb-4">
						
						<!-- 1. HEADER: Name (Editable) & Total -->
						<div class="flex justify-between items-start mb-4" x-data="{ isEditing: false }">
							<div class="flex-grow">
								<h2 x-show="!isEditing" 
									@click="isEditing = true; $nextTick(() => $refs.nameInput.focus())"
									class="text-xl font-extrabold text-gray-800 cursor-pointer border-b border-dashed border-gray-400 inline-block"
									x-text="player.name || 'Tap to name'">
								</h2>
								<input x-show="isEditing" x-ref="nameInput" type="text" x-model="player.name" 
									@keyup.enter="isEditing = false" @blur="isEditing = false"
									class="text-xl font-extrabold text-blue-600 border-b-2 border-blue-500 outline-none w-full bg-transparent p-0">
							</div>
							<div class="text-right">
								<div class="text-3xl font-mono font-black text-blue-600" x-text="calculateTotal(player)"></div>
							</div>
						</div>

						<!-- 2. INPUT: Add points for the current round -->
						<div class="flex gap-2">
							<input type="number" 
								inputmode="numeric" 
								x-model.number="player.tempScore"
								placeholder="Add points"
								@keyup.enter="commitScore(player)"
								class="flex-grow bg-gray-50 border-none rounded-xl px-4 py-3 focus:ring-2 focus:ring-blue-500 text-lg">
							<button @click="commitScore(player)" 
									class="bg-gray-800 text-white px-6 py-3 rounded-xl font-bold active:bg-black transition-transform active:scale-95">
								Add
							</button>
						</div>

						<!-- 3. HISTORY: Visual record of past rounds -->
						<div class="mt-4 flex gap-2 overflow-x-auto pb-1 no-scrollbar">
							<template x-for="(score, sIndex) in player.history" :key="sIndex">
								<div class="bg-gray-100 text-gray-500 text-xs font-bold px-3 py-1 rounded-full border border-gray-200" 
									x-text="score"></div>
							</template>
						</div>
					</div>
				</template>
			</div>
		</main>

		<!-- Link your main.js file -->
		<script th:src="@{/js/main.js}"></script>

		<div th:replace="~{fragments/layout :: footer}"></div>
		<div th:replace="~{fragments/common :: scripts}"></div>
	</body>
</html>
